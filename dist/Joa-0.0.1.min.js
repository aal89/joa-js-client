var JOA=function(){"use strict";function e(e){O.url=e}function t(e){O.header=e}function n(e){var t="",n=Object.keys(m.attribute);if(null!==O.header.gatewayIdentifier&&O.header.gatewayIdentifier.length>0){t+=C,t+=O.header.gatewayIdentifier;for(var r=0;r<n.length;r++){var u=n[r],o=O.header.attribute[u];(null!==o&&o.length>0||o)&&("time"==u?t+=",time":"secret"!==u&&"hash"!==u&&(t+=","+u+"="+o))}t+=v.eol,t.indexOf("vendor=")!==-1?e(null,t):e("no_vendor_attribute_set",null)}else e("no_gatewayidentifier_set",null)}function r(){for(var e=[],t=0;t<x.length;t++){for(var n="",r=x[t],u=Object.keys(r),o=0;o<u.length;o++)n+=r[u[o]]+v.tab;n=n.slice(0,-1)+v.eol,e.push(n)}return e.toString().replace(new RegExp(",","g"),"")}function u(e,t,n,r,u,o,a,l){var s={id:i(),messageType:y.ZCLReport,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:r,attributeId:u,dataTypeId:o,timestamp:a,value:l};return x.push(s),s}function o(){x=[]}function a(e){for(var t=0;t<x.length;t++)if(x[t].id===e){x[t];return x.splice(t,1),!0}return!1}function i(){return b++,b}function l(e){n(function(t,n){t?e(t,null):O.header.attribute.hash?d()?e(null,s(n+r())):e("no_secret_set",null):e(null,n+r())})}function s(e){var t=e.indexOf(v.eol),n=e.slice(0,t)+",hash="+O.md5(O.header.attribute.secret+e)+e.slice(t);return n}function f(e){l(function(t,n){if(t)e(t,null,null);else{var r=new XMLHttpRequest;r.open("POST",O.url,!0);var u="";O.debug?(r.responseType="document",r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u="joa3[ip]=0.0.0.0&joa3[url]=https://joa3.munisense.net/&joa3[body]="+n):(r.setRequestHeader("Content-type","text/plain;charset=UTF-8"),u=n),r.onreadystatechange=function(){if(r.readyState==XMLHttpRequest.DONE)if(200==r.status){o();var t=O.debug?r.response.getElementsByTagName("pre")[0].innerHTML:r.responseText;e(null,t,n)}else e(r.statusText,null,null)},r.send(u)}})}function d(){return O.header.attribute.hash&&O.header.attribute.secret&&O.header.attribute.secret.length>0}function c(){var e=null;return l(function(t,n){e=t?t:n}),e}function h(){var e=null;return l(function(t,n){if(t)e=t;else if(d()){var r=n.indexOf(",hash=")+6,u=n.indexOf(v.eol);e=n.substring(r,u)}else e="no_hashing_enbaled"}),e}var p=!0,g=null,v={tab:"\t",eol:"\n"},m={attribute:{vendor:null,hash:null,secret:null,time:null},gatewayIdentifier:null},C="MuniRPCv2:",b=0,y={ZCLReport:0,ZCLMultiReport:1,ZCLCommand:2,TAZFrame:3,TimeIndication:"t"},x=[],O=function(e){return O.url=e,this},w=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,u,o,a;return u=2147483648&e,o=2147483648&t,n=1073741824&e,r=1073741824&t,a=(1073741823&e)+(1073741823&t),n&r?2147483648^a^u^o:n|r?1073741824&a?3221225472^a^u^o:1073741824^a^u^o:a^u^o}function r(e,t,n){return e&t|~e&n}function u(e,t,n){return e&n|t&~n}function o(e,t,n){return e^t^n}function a(e,t,n){return t^(e|~n)}function i(e,u,o,a,i,l,s){return e=n(e,n(n(r(u,o,a),i),s)),n(t(e,l),u)}function l(e,r,o,a,i,l,s){return e=n(e,n(n(u(r,o,a),i),s)),n(t(e,l),r)}function s(e,r,u,a,i,l,s){return e=n(e,n(n(o(r,u,a),i),s)),n(t(e,l),r)}function f(e,r,u,o,i,l,s){return e=n(e,n(n(a(r,u,o),i),s)),n(t(e,l),r)}function d(e){for(var t,n=e.length,r=n+8,u=(r-r%64)/64,o=16*(u+1),a=Array(o-1),i=0,l=0;l<n;)t=(l-l%4)/4,i=l%4*8,a[t]=a[t]|e.charCodeAt(l)<<i,l++;return t=(l-l%4)/4,i=l%4*8,a[t]=a[t]|128<<i,a[o-2]=n<<3,a[o-1]=n>>>29,a}function c(e){var t,n,r="",u="";for(n=0;n<=3;n++)t=e>>>8*n&255,u="0"+t.toString(16),r+=u.substr(u.length-2,2);return r}function h(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var p,g,v,m,C,b,y,x,O,w=Array(),A=7,S=12,T=17,I=22,R=5,L=9,_=14,M=20,j=4,H=11,J=16,Z=23,q=6,E=10,k=15,F=21;for(e=h(e),w=d(e),b=1732584193,y=4023233417,x=2562383102,O=271733878,p=0;p<w.length;p+=16)g=b,v=y,m=x,C=O,b=i(b,y,x,O,w[p+0],A,3614090360),O=i(O,b,y,x,w[p+1],S,3905402710),x=i(x,O,b,y,w[p+2],T,606105819),y=i(y,x,O,b,w[p+3],I,3250441966),b=i(b,y,x,O,w[p+4],A,4118548399),O=i(O,b,y,x,w[p+5],S,1200080426),x=i(x,O,b,y,w[p+6],T,2821735955),y=i(y,x,O,b,w[p+7],I,4249261313),b=i(b,y,x,O,w[p+8],A,1770035416),O=i(O,b,y,x,w[p+9],S,2336552879),x=i(x,O,b,y,w[p+10],T,4294925233),y=i(y,x,O,b,w[p+11],I,2304563134),b=i(b,y,x,O,w[p+12],A,1804603682),O=i(O,b,y,x,w[p+13],S,4254626195),x=i(x,O,b,y,w[p+14],T,2792965006),y=i(y,x,O,b,w[p+15],I,1236535329),b=l(b,y,x,O,w[p+1],R,4129170786),O=l(O,b,y,x,w[p+6],L,3225465664),x=l(x,O,b,y,w[p+11],_,643717713),y=l(y,x,O,b,w[p+0],M,3921069994),b=l(b,y,x,O,w[p+5],R,3593408605),O=l(O,b,y,x,w[p+10],L,38016083),x=l(x,O,b,y,w[p+15],_,3634488961),y=l(y,x,O,b,w[p+4],M,3889429448),b=l(b,y,x,O,w[p+9],R,568446438),O=l(O,b,y,x,w[p+14],L,3275163606),x=l(x,O,b,y,w[p+3],_,4107603335),y=l(y,x,O,b,w[p+8],M,1163531501),b=l(b,y,x,O,w[p+13],R,2850285829),O=l(O,b,y,x,w[p+2],L,4243563512),x=l(x,O,b,y,w[p+7],_,1735328473),y=l(y,x,O,b,w[p+12],M,2368359562),b=s(b,y,x,O,w[p+5],j,4294588738),O=s(O,b,y,x,w[p+8],H,2272392833),x=s(x,O,b,y,w[p+11],J,1839030562),y=s(y,x,O,b,w[p+14],Z,4259657740),b=s(b,y,x,O,w[p+1],j,2763975236),O=s(O,b,y,x,w[p+4],H,1272893353),x=s(x,O,b,y,w[p+7],J,4139469664),y=s(y,x,O,b,w[p+10],Z,3200236656),b=s(b,y,x,O,w[p+13],j,681279174),O=s(O,b,y,x,w[p+0],H,3936430074),x=s(x,O,b,y,w[p+3],J,3572445317),y=s(y,x,O,b,w[p+6],Z,76029189),b=s(b,y,x,O,w[p+9],j,3654602809),O=s(O,b,y,x,w[p+12],H,3873151461),x=s(x,O,b,y,w[p+15],J,530742520),y=s(y,x,O,b,w[p+2],Z,3299628645),b=f(b,y,x,O,w[p+0],q,4096336452),O=f(O,b,y,x,w[p+7],E,1126891415),x=f(x,O,b,y,w[p+14],k,2878612391),y=f(y,x,O,b,w[p+5],F,4237533241),b=f(b,y,x,O,w[p+12],q,1700485571),O=f(O,b,y,x,w[p+3],E,2399980690),x=f(x,O,b,y,w[p+10],k,4293915773),y=f(y,x,O,b,w[p+1],F,2240044497),b=f(b,y,x,O,w[p+8],q,1873313359),O=f(O,b,y,x,w[p+15],E,4264355552),x=f(x,O,b,y,w[p+6],k,2734768916),y=f(y,x,O,b,w[p+13],F,1309151649),b=f(b,y,x,O,w[p+4],q,4149444226),O=f(O,b,y,x,w[p+11],E,3174756917),x=f(x,O,b,y,w[p+2],k,718787259),y=f(y,x,O,b,w[p+9],F,3951481745),b=n(b,g),y=n(y,v),x=n(x,m),O=n(O,C);var N=c(b)+c(y)+c(x)+c(O);return N.toLowerCase()};return O.debug=p,O.url=g,O.header=m,O.prototype.constructor=O,O.headers=t,O.setUrl=e,O.addZCLReport=u,O.clearMessages=o,O.removeMessage=a,O.post=f,O.toString=c,O.toHash=h,O.md5=w,O}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=JOA),exports.JOA=JOA):this.JOA=JOA;