var JOA=function(){"use strict";function e(e){Z.header=e}function t(e){var t,n="",r=Object.keys(O.attribute);if(null!==Z.header.gatewayIdentifier&&Z.header.gatewayIdentifier.length>0){for(n+=w,n+=Z.header.gatewayIdentifier,t=0;t<r.length;t+=1){var o=r[t],a=Z.header.attribute[o];(null!==a&&a.length>0||a)&&("time"===o?n+=",time":"secret"!==o&&"hash"!==o&&(n+=","+o+"="+a))}n+=M.eol,n.indexOf("vendor=")!==-1?e(null,n):e("no_vendor_attribute_set",null)}else e("no_gatewayidentifier_set",null)}function n(){var e,t,n=[];for(e=0;e<A.length;e+=1){var r="",o=A[e];o.status&&delete o.status;var a=Object.keys(o);for(t=0;t<a.length;t+=1)r+=o[a[t]]+M.tab;r=r.slice(0,-1)+M.eol,n.push(r)}return n.toString().replace(new RegExp(",","g"),"")}function r(){return R+=1}function o(e){A.push(e)}function a(e,t,n,o,a,s,i,u){var d={id:r(),messageType:S.ZCLReport,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:o,attributeId:a,dataTypeId:s,timestamp:i,value:u};return A.push(d),d}function s(e,t,n,o,a,s,i,u,d){var l={id:r(),messageType:S.ZCLMultiReport,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:o,attributeId:a,dataTypeId:s,timestamp:i,offset:u,values:d.toString().replace(new RegExp(",","g"),M.tab)};return A.push(l),l}function i(e,t,n,o,a,s,i,u){var d={id:r(),messageType:S.ZCLCommand,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:o,isClusterSpecific:a,commandId:s,timestamp:i,value:u};return A.push(d),d}function u(){A=[]}function d(){return A}function l(e){var t;for(t=0;t<A.length;t+=1)if(A[t].id===e)return A[t];return{}}function c(e){var t;for(t=0;t<A.length;t+=1)if(A[t].id===e){A[t];return A.splice(t,1),!0}return!1}function f(){return Z.header.attribute.hash&&Z.header.attribute.secret&&Z.header.attribute.secret.length>0}function p(e){var t=e.indexOf(M.eol),n=Z.md5(Z.header.attribute.secret+e),r=e.slice(0,t)+",hash="+n+e.slice(t);return r}function h(e){t(function(t,r){t?e(t,null):Z.header.attribute.hash?f()?e(null,p(r+n())):e("no_secret_set",null):e(null,r+n())})}function g(e){var t,n,r=e.split(M.eol),o=[];for(t=0;t<r.length-1;t+=1){var a=r[t].split(M.tab),s=[];for(n=2;n<a.length;n+=1)s.push(a[n]);var i,u=a[0];i="t"!==u?{type:u,code:L[a[1]],messages:s}:{type:u,timestamp:a[1]},o.push(i)}return o}function m(e,t){var n,r,o=L[489];for(n=0;n<t.length;n+=1)if("s"===t[n].type){var a=t[n].messages;for(r=0;r<a.length;r+=1)if(e.id==a[r])return t[n].code;0===a.length&&(o=t[n].code)}return o}function v(e,t){var n,r=[];for(n=0;n<e.length;n+=1){var o=m(e[n],t);200===o.code&&(e[n].status=o,r.push(e[n]))}return r}function x(e,t){var n,r=[];for(n=0;n<e.length;n+=1){var o=m(e[n],t);200!==o.code&&(e[n].status=o,r.push(e[n]))}return r}function y(e,t){h(function(r,o){if(r)t(r,null,null);else{var a=new XMLHttpRequest,s="";a.open("POST",Z.url,!0),Z.debug?(a.responseType="document",a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s="joa3[ip]=0.0.0.0&joa3[url]=https://joa3.munisense.net/&joa3[body]="+o):(a.setRequestHeader("Content-type","text/plain;charset=UTF-8"),s=o),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){var r=n(),o=d(),s=Z.debug?a.response.getElementsByTagName("pre")[0].innerHTML:a.responseText,i=g(s),l=v(o,i),c=x(o,i);e&&e.clear&&u(),e&&e.clearOnlySuccess&&(A=c),0===d().length&&(R=e&&e.resetMessageIdsTo||0),t&&t(null,{raw:s,parsed:i},{raw:r,parsed:{success:l,failed:c,all:o}})}else t&&t({code:a.status,text:a.statusText},null,null)},a.send(s)}})}function C(){var e=null;return h(function(t,n){e=t?t:n}),e}function I(){var e=null;return h(function(t,n){if(t)e=t;else if(f()){var r=n.indexOf(",hash=")+6,o=n.indexOf(M.eol);e=n.substring(r,o)}else e="no_hashing_enbaled"}),e}var b=!0,T=null,M={tab:"\t",eol:"\n"},O={attribute:{vendor:null,hash:null,secret:null,time:null},gatewayIdentifier:null},w="MuniRPCv2:",R=0,S={ZCLReport:0,ZCLMultiReport:1,ZCLCommand:2,TAZFrame:3,TimeIndication:"t"},L={200:{code:200,text:"OK",description:"Message is received and processed."},480:{code:480,text:"Empty Message",description:"When there is only an ID and no message type field."},481:{code:481,text:"Invalid ID",description:"The format of the ID is not valid."},482:{code:482,text:"Missing ID",description:"The message will not be processed due to invalid authorization."},483:{code:483,text:"Invalid Message",description:"Type The message type is not valid."},484:{code:484,text:"Invalid Element",description:"Count The message does not have the expected amount of fields."},485:{code:485,text:"Incomplete Message",description:"Not all fields have values or could be copied from the previous value."},486:{code:486,text:"Invalid Offset",description:"The offset value in a MultiReport message is not valid."},487:{nr:487,text:"Invalid Value",description:"The value of one of the fields in a message is not valid."},488:{code:488,text:"Not Implemented",description:"The message type or feature was not implemented."},489:{code:489,text:"Error processing message",description:"The message was correct but could not be processed."}},A=[],Z=function(e){return Z.url=e||"https://joa3.munisense.net/",this},_=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,o,a,s;return o=2147483648&e,a=2147483648&t,n=1073741824&e,r=1073741824&t,s=(1073741823&e)+(1073741823&t),n&r?2147483648^s^o^a:n|r?1073741824&s?3221225472^s^o^a:1073741824^s^o^a:s^o^a}function r(e,t,n){return e&t|~e&n}function o(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function i(e,o,a,s,i,u,d){return e=n(e,n(n(r(o,a,s),i),d)),n(t(e,u),o)}function u(e,r,a,s,i,u,d){return e=n(e,n(n(o(r,a,s),i),d)),n(t(e,u),r)}function d(e,r,o,s,i,u,d){return e=n(e,n(n(a(r,o,s),i),d)),n(t(e,u),r)}function l(e,r,o,a,i,u,d){return e=n(e,n(n(s(r,o,a),i),d)),n(t(e,u),r)}function c(e){for(var t,n=e.length,r=n+8,o=(r-r%64)/64,a=16*(o+1),s=Array(a-1),i=0,u=0;u<n;)t=(u-u%4)/4,i=u%4*8,s[t]=s[t]|e.charCodeAt(u)<<i,u++;return t=(u-u%4)/4,i=u%4*8,s[t]=s[t]|128<<i,s[a-2]=n<<3,s[a-1]=n>>>29,s}function f(e){var t,n,r="",o="";for(n=0;n<=3;n++)t=e>>>8*n&255,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}function p(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var h,g,m,v,x,y,C,I,b,T=Array(),M=7,O=12,w=17,R=22,S=5,L=9,A=14,Z=20,_=4,j=11,E=16,H=23,J=6,D=10,q=15,N=21;for(e=p(e),T=c(e),y=1732584193,C=4023233417,I=2562383102,b=271733878,h=0;h<T.length;h+=16)g=y,m=C,v=I,x=b,y=i(y,C,I,b,T[h+0],M,3614090360),b=i(b,y,C,I,T[h+1],O,3905402710),I=i(I,b,y,C,T[h+2],w,606105819),C=i(C,I,b,y,T[h+3],R,3250441966),y=i(y,C,I,b,T[h+4],M,4118548399),b=i(b,y,C,I,T[h+5],O,1200080426),I=i(I,b,y,C,T[h+6],w,2821735955),C=i(C,I,b,y,T[h+7],R,4249261313),y=i(y,C,I,b,T[h+8],M,1770035416),b=i(b,y,C,I,T[h+9],O,2336552879),I=i(I,b,y,C,T[h+10],w,4294925233),C=i(C,I,b,y,T[h+11],R,2304563134),y=i(y,C,I,b,T[h+12],M,1804603682),b=i(b,y,C,I,T[h+13],O,4254626195),I=i(I,b,y,C,T[h+14],w,2792965006),C=i(C,I,b,y,T[h+15],R,1236535329),y=u(y,C,I,b,T[h+1],S,4129170786),b=u(b,y,C,I,T[h+6],L,3225465664),I=u(I,b,y,C,T[h+11],A,643717713),C=u(C,I,b,y,T[h+0],Z,3921069994),y=u(y,C,I,b,T[h+5],S,3593408605),b=u(b,y,C,I,T[h+10],L,38016083),I=u(I,b,y,C,T[h+15],A,3634488961),C=u(C,I,b,y,T[h+4],Z,3889429448),y=u(y,C,I,b,T[h+9],S,568446438),b=u(b,y,C,I,T[h+14],L,3275163606),I=u(I,b,y,C,T[h+3],A,4107603335),C=u(C,I,b,y,T[h+8],Z,1163531501),y=u(y,C,I,b,T[h+13],S,2850285829),b=u(b,y,C,I,T[h+2],L,4243563512),I=u(I,b,y,C,T[h+7],A,1735328473),C=u(C,I,b,y,T[h+12],Z,2368359562),y=d(y,C,I,b,T[h+5],_,4294588738),b=d(b,y,C,I,T[h+8],j,2272392833),I=d(I,b,y,C,T[h+11],E,1839030562),C=d(C,I,b,y,T[h+14],H,4259657740),y=d(y,C,I,b,T[h+1],_,2763975236),b=d(b,y,C,I,T[h+4],j,1272893353),I=d(I,b,y,C,T[h+7],E,4139469664),C=d(C,I,b,y,T[h+10],H,3200236656),y=d(y,C,I,b,T[h+13],_,681279174),b=d(b,y,C,I,T[h+0],j,3936430074),I=d(I,b,y,C,T[h+3],E,3572445317),C=d(C,I,b,y,T[h+6],H,76029189),y=d(y,C,I,b,T[h+9],_,3654602809),b=d(b,y,C,I,T[h+12],j,3873151461),I=d(I,b,y,C,T[h+15],E,530742520),C=d(C,I,b,y,T[h+2],H,3299628645),y=l(y,C,I,b,T[h+0],J,4096336452),b=l(b,y,C,I,T[h+7],D,1126891415),I=l(I,b,y,C,T[h+14],q,2878612391),C=l(C,I,b,y,T[h+5],N,4237533241),y=l(y,C,I,b,T[h+12],J,1700485571),b=l(b,y,C,I,T[h+3],D,2399980690),I=l(I,b,y,C,T[h+10],q,4293915773),C=l(C,I,b,y,T[h+1],N,2240044497),y=l(y,C,I,b,T[h+8],J,1873313359),b=l(b,y,C,I,T[h+15],D,4264355552),I=l(I,b,y,C,T[h+6],q,2734768916),C=l(C,I,b,y,T[h+13],N,1309151649),y=l(y,C,I,b,T[h+4],J,4149444226),b=l(b,y,C,I,T[h+11],D,3174756917),I=l(I,b,y,C,T[h+2],q,718787259),C=l(C,I,b,y,T[h+9],N,3951481745),y=n(y,g),C=n(C,m),I=n(I,v),b=n(b,x);var k=f(y)+f(C)+f(I)+f(b);return k.toLowerCase()};return Z.debug=b,Z.url=T,Z.header=O,Z.prototype.constructor=Z,Z.headers=e,Z.addObject=o,Z.addZCLReport=a,Z.addZCLMultiReport=s,Z.addZCLCommand=i,Z.getMessage=l,Z.getMessages=d,Z.clearMessages=u,Z.removeMessage=c,Z.toString=C,Z.toHash=I,Z.md5=_,Z.post=y,Z}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=JOA),exports.JOA=JOA):this.JOA=JOA;