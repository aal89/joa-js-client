var JOA=function(){"use strict";function e(e){T.url=e}function t(e){T.header=e}function n(e){var t,n="",r=Object.keys(y.attribute);if(null!==T.header.gatewayIdentifier&&T.header.gatewayIdentifier.length>0){for(n+=b,n+=T.header.gatewayIdentifier,t=0;t<r.length;t+=1){var u=r[t],a=T.header.attribute[u];(null!==a&&a.length>0||a)&&("time"===u?n+=",time":"secret"!==u&&"hash"!==u&&(n+=","+u+"="+a))}n+=C.eol,n.indexOf("vendor=")!==-1?e(null,n):e("no_vendor_attribute_set",null)}else e("no_gatewayidentifier_set",null)}function r(){var e,t,n=[];for(e=0;e<O.length;e+=1){var r="",u=O[e],a=Object.keys(u);for(t=0;t<a.length;t+=1)r+=u[a[t]]+C.tab;r=r.slice(0,-1)+C.eol,n.push(r)}return n.toString().replace(new RegExp(",","g"),"")}function u(){return x+=1}function a(e,t,n,r,a,o,i,l){var s={id:u(),messageType:I.ZCLReport,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:r,attributeId:a,dataTypeId:o,timestamp:i,value:l};return O.push(s),s}function o(e,t,n,r,a,o,i,l,s){var d={id:u(),messageType:I.ZCLMultiReport,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:r,attributeId:a,dataTypeId:o,timestamp:i,offset:l,values:s.toString().replace(new RegExp(",","g"),C.tab)};return O.push(d),d}function i(e,t,n,r,a,o,i,l){var s={id:u(),messageType:I.ZCLCommand,eui64:e,endpointId:t||"0x0a",profileId:n||"0xf100",clusterId:r,isClusterSpecific:a,commandId:o,timestamp:i,value:l};return O.push(s),s}function l(){O=[]}function s(e){var t;for(t=0;t<O.length;t+=1)if(O[t].id===e){O[t];return O.splice(t,1),!0}return!1}function d(){return T.header.attribute.hash&&T.header.attribute.secret&&T.header.attribute.secret.length>0}function f(e){var t=e.indexOf(C.eol),n=T.md5(T.header.attribute.secret+e),r=e.slice(0,t)+",hash="+n+e.slice(t);return r}function c(e){n(function(t,n){t?e(t,null):T.header.attribute.hash?d()?e(null,f(n+r())):e("no_secret_set",null):e(null,n+r())})}function p(e){c(function(t,n){if(t)e(t,null,null);else{var u=new XMLHttpRequest,a="";u.open("POST",T.url,!0),T.debug?(u.responseType="document",u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a="joa3[ip]=0.0.0.0&joa3[url]=https://joa3.munisense.net/&joa3[body]="+n):(u.setRequestHeader("Content-type","text/plain;charset=UTF-8"),a=n),u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(200===u.status){var t=r(),n=T.debug?u.response.getElementsByTagName("pre")[0].innerHTML:u.responseText;l(),e(null,n,t)}else e(u.statusText,null,null)},u.send(a)}})}function h(){var e=null;return c(function(t,n){e=t?t:n}),e}function g(){var e=null;return c(function(t,n){if(t)e=t;else if(d()){var r=n.indexOf(",hash=")+6,u=n.indexOf(C.eol);e=n.substring(r,u)}else e="no_hashing_enbaled"}),e}var m=!0,v=null,C={tab:"\t",eol:"\n"},y={attribute:{vendor:null,hash:null,secret:null,time:null},gatewayIdentifier:null},b="MuniRPCv2:",x=0,I={ZCLReport:0,ZCLMultiReport:1,ZCLCommand:2,TAZFrame:3,TimeIndication:"t"},O=[],T=function(e){return T.url=e||"https://joa3.munisense.net/",this},L=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,u,a,o;return u=2147483648&e,a=2147483648&t,n=1073741824&e,r=1073741824&t,o=(1073741823&e)+(1073741823&t),n&r?2147483648^o^u^a:n|r?1073741824&o?3221225472^o^u^a:1073741824^o^u^a:o^u^a}function r(e,t,n){return e&t|~e&n}function u(e,t,n){return e&n|t&~n}function a(e,t,n){return e^t^n}function o(e,t,n){return t^(e|~n)}function i(e,u,a,o,i,l,s){return e=n(e,n(n(r(u,a,o),i),s)),n(t(e,l),u)}function l(e,r,a,o,i,l,s){return e=n(e,n(n(u(r,a,o),i),s)),n(t(e,l),r)}function s(e,r,u,o,i,l,s){return e=n(e,n(n(a(r,u,o),i),s)),n(t(e,l),r)}function d(e,r,u,a,i,l,s){return e=n(e,n(n(o(r,u,a),i),s)),n(t(e,l),r)}function f(e){for(var t,n=e.length,r=n+8,u=(r-r%64)/64,a=16*(u+1),o=Array(a-1),i=0,l=0;l<n;)t=(l-l%4)/4,i=l%4*8,o[t]=o[t]|e.charCodeAt(l)<<i,l++;return t=(l-l%4)/4,i=l%4*8,o[t]=o[t]|128<<i,o[a-2]=n<<3,o[a-1]=n>>>29,o}function c(e){var t,n,r="",u="";for(n=0;n<=3;n++)t=e>>>8*n&255,u="0"+t.toString(16),r+=u.substr(u.length-2,2);return r}function p(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var h,g,m,v,C,y,b,x,I,O=Array(),T=7,L=12,R=17,S=22,w=5,A=9,Z=14,M=20,_=4,j=11,H=16,J=23,q=6,E=10,k=15,F=21;for(e=p(e),O=f(e),y=1732584193,b=4023233417,x=2562383102,I=271733878,h=0;h<O.length;h+=16)g=y,m=b,v=x,C=I,y=i(y,b,x,I,O[h+0],T,3614090360),I=i(I,y,b,x,O[h+1],L,3905402710),x=i(x,I,y,b,O[h+2],R,606105819),b=i(b,x,I,y,O[h+3],S,3250441966),y=i(y,b,x,I,O[h+4],T,4118548399),I=i(I,y,b,x,O[h+5],L,1200080426),x=i(x,I,y,b,O[h+6],R,2821735955),b=i(b,x,I,y,O[h+7],S,4249261313),y=i(y,b,x,I,O[h+8],T,1770035416),I=i(I,y,b,x,O[h+9],L,2336552879),x=i(x,I,y,b,O[h+10],R,4294925233),b=i(b,x,I,y,O[h+11],S,2304563134),y=i(y,b,x,I,O[h+12],T,1804603682),I=i(I,y,b,x,O[h+13],L,4254626195),x=i(x,I,y,b,O[h+14],R,2792965006),b=i(b,x,I,y,O[h+15],S,1236535329),y=l(y,b,x,I,O[h+1],w,4129170786),I=l(I,y,b,x,O[h+6],A,3225465664),x=l(x,I,y,b,O[h+11],Z,643717713),b=l(b,x,I,y,O[h+0],M,3921069994),y=l(y,b,x,I,O[h+5],w,3593408605),I=l(I,y,b,x,O[h+10],A,38016083),x=l(x,I,y,b,O[h+15],Z,3634488961),b=l(b,x,I,y,O[h+4],M,3889429448),y=l(y,b,x,I,O[h+9],w,568446438),I=l(I,y,b,x,O[h+14],A,3275163606),x=l(x,I,y,b,O[h+3],Z,4107603335),b=l(b,x,I,y,O[h+8],M,1163531501),y=l(y,b,x,I,O[h+13],w,2850285829),I=l(I,y,b,x,O[h+2],A,4243563512),x=l(x,I,y,b,O[h+7],Z,1735328473),b=l(b,x,I,y,O[h+12],M,2368359562),y=s(y,b,x,I,O[h+5],_,4294588738),I=s(I,y,b,x,O[h+8],j,2272392833),x=s(x,I,y,b,O[h+11],H,1839030562),b=s(b,x,I,y,O[h+14],J,4259657740),y=s(y,b,x,I,O[h+1],_,2763975236),I=s(I,y,b,x,O[h+4],j,1272893353),x=s(x,I,y,b,O[h+7],H,4139469664),b=s(b,x,I,y,O[h+10],J,3200236656),y=s(y,b,x,I,O[h+13],_,681279174),I=s(I,y,b,x,O[h+0],j,3936430074),x=s(x,I,y,b,O[h+3],H,3572445317),b=s(b,x,I,y,O[h+6],J,76029189),y=s(y,b,x,I,O[h+9],_,3654602809),I=s(I,y,b,x,O[h+12],j,3873151461),x=s(x,I,y,b,O[h+15],H,530742520),b=s(b,x,I,y,O[h+2],J,3299628645),y=d(y,b,x,I,O[h+0],q,4096336452),I=d(I,y,b,x,O[h+7],E,1126891415),x=d(x,I,y,b,O[h+14],k,2878612391),b=d(b,x,I,y,O[h+5],F,4237533241),y=d(y,b,x,I,O[h+12],q,1700485571),I=d(I,y,b,x,O[h+3],E,2399980690),x=d(x,I,y,b,O[h+10],k,4293915773),b=d(b,x,I,y,O[h+1],F,2240044497),y=d(y,b,x,I,O[h+8],q,1873313359),I=d(I,y,b,x,O[h+15],E,4264355552),x=d(x,I,y,b,O[h+6],k,2734768916),b=d(b,x,I,y,O[h+13],F,1309151649),y=d(y,b,x,I,O[h+4],q,4149444226),I=d(I,y,b,x,O[h+11],E,3174756917),x=d(x,I,y,b,O[h+2],k,718787259),b=d(b,x,I,y,O[h+9],F,3951481745),y=n(y,g),b=n(b,m),x=n(x,v),I=n(I,C);var N=c(y)+c(b)+c(x)+c(I);return N.toLowerCase()};return T.debug=m,T.url=v,T.header=y,T.prototype.constructor=T,T.headers=t,T.setUrl=e,T.addZCLReport=a,T.addZCLMultiReport=o,T.addZCLCommand=i,T.clearMessages=l,T.removeMessage=s,T.toString=h,T.toHash=g,T.md5=L,T.post=p,T}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=JOA),exports.JOA=JOA):this.JOA=JOA;